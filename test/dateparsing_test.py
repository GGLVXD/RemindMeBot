from datetime import datetime

import utils


def test_date_parsing():
	base_time = utils.datetime_force_utc(datetime.strptime("2019-01-01 01:23:45", "%Y-%m-%d %H:%M:%S"))

	pairs = [
		["1 day", "2019-01-02 01:23:45"],
		["365 days", "2020-01-01 01:23:45"],
		["2 weeks", "2019-01-15 01:23:45"],
		["3 years", "2022-01-01 01:23:45"],
		["3 months", "2019-04-01 01:23:45"],
		["24 hours", "2019-01-02 01:23:45"],
		["5 hrs", "2019-01-01 06:23:45"],
		["20 minutes", "2019-01-01 01:43:45"],
		["5 seconds", "2019-01-01 01:23:50"],
		["tomorrow", "2019-01-02 01:23:45"],
		["Next Thursday at 4pm", "2019-01-10 16:00:00"],
		["Tonight", "2019-01-01 21:00:00"],
		["2 Hours After Noon", "2019-01-01 14:00:00"],
		["eoy", "2019-12-31 09:00:00"],
		["eom", "2019-01-31 09:00:00"],
		["eod", "2019-01-01 17:00:00"],
		["2022-01-01", "2022-01-01 00:00:00"],
		["10/15/19", "2019-10-15 00:00:00"],
		["April 9, 2020", "2020-04-09 00:00:00"],
		["January 13th, 2020", "2020-01-13 00:00:00"],
		["January 5th 2020", "2020-01-05 00:00:00"],
		["June 2nd", "2019-06-02 00:00:00"],
		["November 2", "2019-11-02 00:00:00"],
		["August 25, 2018, at 4pm", "2018-08-25 16:00:00"],
		["September 1, 2019 14:00:00", "2019-09-01 14:00:00"],
		["august", "2019-08-01 00:00:00"],
		["September", "2019-09-01 00:00:00"],
		["2025", "2025-01-01 00:00:00"],
		["2pm", "2019-01-01 14:00:00"],
		["7:20 pm", "2019-01-01 19:20:00"],
		["72hr", "2019-01-04 01:23:45"],
		["1d", "2019-01-02 01:23:45"],
		["1yr", "2020-01-01 01:23:45"],
		["7h", "2019-01-01 08:23:45"],
		["35m", "2019-01-01 01:58:45"],
	]

	for time_string, expected_string in pairs:
		result_date = utils.parse_time(time_string, base_time)
		expected_date = utils.datetime_force_utc(datetime.strptime(expected_string, "%Y-%m-%d %H:%M:%S"))
		assert result_date == expected_date
